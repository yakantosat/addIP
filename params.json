{"name":"Addip","tagline":"","body":"利用ngx.timer.at来实现定时扫描文件来获取更新\r\nnginx.conf的配置如下\r\n`http {`\r\n    `...`\r\n    `# 在worker进程启动时开启check.lua中的功能`\r\n    `init_worker_by_lua_file\t'conf/cop/check.lua';`\r\n\r\n    `# 为check.lua中需要的共享内存区分配大小，大小为10m。`\r\n    `lua_shared_dict\tmy_cache\t10m;`\r\n\r\n    `...`\r\n`}`\r\n\r\n`location /access {`\r\n    `content_by_lua\t'`\r\n        `local args = ngx.req.get_uri_args()`\r\n        `local my_cache = ngx.shared.my_cache`\r\n        `local value, flags = my_cache:get(args[\"ip\"])`\r\n        `if not value then`\r\n            `ngx.say(\"ip not exist: \", args[\"ip\"])`\r\n        `else`\r\n            `ngx.say(\"true: \", value)`\r\n        `end`\r\n    `';`\r\n`}`\r\n\r\n在服务器上访问该location\r\n* curl localhost/access?ip=10.25.10.10       ==>  ip not exist: 10.25.10.10\r\n\r\n当在/home/nginx/conf/cop/下修改ip.txt，添加10.25.10.10之后访问（10秒后）\r\n* curl localhost/access?ip=10.25.10.10       ==>  true: 10.25.10.10\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}